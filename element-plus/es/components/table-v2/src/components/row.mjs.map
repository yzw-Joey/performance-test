{"version":3,"file":"row.mjs","sources":["../../../../../../../packages/components/table-v2/src/components/row.tsx"],"sourcesContent":["import {\n  computed,\n  defineComponent,\n  inject,\n  nextTick,\n  onMounted,\n  ref,\n  unref,\n} from 'vue'\nimport { isArray, isFunction, isNumber } from '@element-plus/utils'\nimport { tableV2RowProps } from '../row'\nimport { TableV2InjectionKey } from '../tokens'\nimport { placeholderSign } from '../private'\n\nimport type { CSSProperties, RendererElement, RendererNode, VNode } from 'vue'\nimport type { RowEventHandlers, TableV2RowProps } from '../row'\n\ntype CustomizedCellsType = VNode<\n  RendererNode,\n  RendererElement,\n  {\n    [key: string]: any\n  }\n>[]\n\ntype DefaultCellsType = VNode<\n  RendererNode,\n  RendererElement,\n  {\n    [key: string]: any\n  }\n>[][]\n\ntype ColumnCellsType = DefaultCellsType | CustomizedCellsType\n\nconst useTableRow = (props: TableV2RowProps) => {\n  const { isScrolling } = inject(TableV2InjectionKey)!\n\n  const measured = ref(false)\n  const rowRef = ref<HTMLElement>()\n  const measurable = computed(() => {\n    return isNumber(props.estimatedRowHeight) && props.rowIndex >= 0\n  })\n\n  const doMeasure = (isInit = false) => {\n    const $rowRef = unref(rowRef)\n    if (!$rowRef) return\n    const { columns, onRowHeightChange, rowKey, rowIndex, style } = props\n    const { height } = $rowRef.getBoundingClientRect()\n    measured.value = true\n\n    nextTick(() => {\n      if (isInit || height !== Number.parseInt(style!.height as string)) {\n        const firstColumn = columns[0]\n        const isPlaceholder = firstColumn?.placeholderSign === placeholderSign\n        onRowHeightChange?.(\n          { rowKey, height, rowIndex },\n          firstColumn && !isPlaceholder && firstColumn.fixed\n        )\n      }\n    })\n  }\n\n  const eventHandlers = computed(() => {\n    const { rowData, rowIndex, rowKey } = props\n    const handlers = props.rowEventHandlers || ({} as RowEventHandlers)\n    const eventHandlers = {} as {\n      [key in keyof RowEventHandlers]: (e: Event) => void\n    }\n\n    Object.entries(handlers).forEach(([eventName, handler]) => {\n      if (isFunction(handler)) {\n        eventHandlers[eventName as keyof RowEventHandlers] = (event: Event) => {\n          handler({\n            event,\n            rowData,\n            rowIndex,\n            rowKey,\n          })\n        }\n      }\n    })\n\n    // if (onRowHover) {\n    //   ;(\n    //     [\n    //       { name: 'onMouseleave', hovered: false },\n    //       { name: 'onMouseenter', hovered: true },\n    //     ] as const\n    //   ).forEach(({ name, hovered }) => {\n    //     const existedHandler = eventHandlers[name]\n    //     eventHandlers[name] = ((event: MouseEvent) => {\n    //       onRowHover({\n    //         event,\n    //         hovered,\n    //         rowData,\n    //         rowIndex,\n    //         rowKey,\n    //       })\n\n    //       existedHandler?.(event)\n    //     }) as any\n    //   })\n    // }\n    return eventHandlers\n  })\n\n  const onExpand = (expanded: boolean) => {\n    const { onRowExpand, rowData, rowIndex, rowKey } = props\n\n    onRowExpand?.({\n      expanded,\n      rowData,\n      rowIndex,\n      rowKey,\n    })\n  }\n\n  onMounted(() => {\n    if (unref(measurable)) {\n      doMeasure(true)\n    }\n  })\n\n  return { isScrolling, measurable, measured, rowRef, eventHandlers, onExpand }\n}\n\nconst COMPONENT_NAME = 'ElTableV2TableRow'\n\nconst TableV2Row = defineComponent({\n  name: COMPONENT_NAME,\n  props: tableV2RowProps,\n  setup(props, { expose, slots, attrs }) {\n    const {\n      eventHandlers,\n      isScrolling,\n      measurable,\n      measured,\n      rowRef,\n\n      onExpand,\n    } = useTableRow(props)\n\n    expose({\n      /**\n       * @description manually dispatching expand action on row.\n       */\n      onExpand,\n    })\n\n    return () => {\n      const {\n        columns,\n        columnsStyles,\n        expandColumnKey,\n        depth,\n        rowData,\n        rowIndex,\n        style,\n      } = props\n\n      let ColumnCells: ColumnCellsType = columns.map((column, columnIndex) => {\n        const expandable =\n          isArray(rowData.children) &&\n          rowData.children.length > 0 &&\n          column.key === expandColumnKey\n\n        return slots.cell!({\n          column,\n          columns,\n          columnIndex,\n          depth,\n          style: columnsStyles[column.key],\n          rowData,\n          rowIndex,\n          isScrolling: unref(isScrolling),\n          expandIconProps: expandable\n            ? {\n                rowData,\n                rowIndex,\n                onExpand,\n              }\n            : undefined,\n        })\n      })\n\n      if (slots.row) {\n        ColumnCells = slots.row({\n          cells: ColumnCells.map((node) => {\n            if (isArray(node) && node.length === 1) {\n              return node[0]\n            }\n            return node\n          }),\n          style,\n          columns,\n          depth,\n          rowData,\n          rowIndex,\n          isScrolling: unref(isScrolling),\n        })\n      }\n\n      if (unref(measurable)) {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { height, ...exceptHeightStyle } = style || {}\n        const _measured = unref(measured)\n        return (\n          <div\n            ref={rowRef}\n            class={props.class}\n            style={_measured ? style : exceptHeightStyle}\n            role=\"row\"\n            {...attrs}\n            {...unref(eventHandlers)}\n          >\n            {ColumnCells}\n          </div>\n        )\n      }\n\n      return (\n        <div\n          {...attrs}\n          ref={rowRef}\n          class={props.class}\n          style={style}\n          role=\"row\"\n          {...unref(eventHandlers)}\n        >\n          {ColumnCells}\n        </div>\n      )\n    }\n  },\n})\n\nexport default TableV2Row\n\nexport type TableV2RowCellRenderParam = {\n  column: TableV2RowProps['columns'][number]\n  columns: TableV2RowProps['columns']\n  columnIndex: number\n  depth: number\n  style: CSSProperties\n  rowData: any\n  rowIndex: number\n  isScrolling: boolean\n  expandIconProps?: {\n    rowData: any\n    rowIndex: number\n    onExpand: (expand: boolean) => void\n  }\n}\n"],"names":["useTableRow","isScrolling","inject","TableV2InjectionKey","measured","rowRef","ref","isNumber","doMeasure","columns","onRowHeightChange","rowKey","rowIndex","style","height","$rowRef","getBoundingClientRect","value","nextTick","parseInt","firstColumn","placeholderSign","rowData","handlers","props","rowEventHandlers","eventHandlers","Object","forEach","eventName","isFunction","handler","event","onExpand","onRowExpand","onMounted","measurable","COMPONENT_NAME","TableV2Row","name","attrs","expose","ColumnCells","expandable","slots","cell","column","columnIndex","unref","_createVNode","undefined","row","cells","isArray","node"],"mappings":"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"}